{
  "version": "1.0.0",
  "lastUpdated": "2024-01-01T00:00:00Z",
  "description": "Microsoft 365 Phishing Protection detection rules for identifying phishing attempts targeting Microsoft 365 login pages",
  
  "rules": [
    {
      "id": "check_legitimate_domain",
      "type": "url",
      "weight": 30,
      "condition": {
        "domains": [
          "login.microsoftonline.com",
          "login.microsoft.com", 
          "login.live.com",
          "account.microsoft.com",
          "portal.office.com",
          "outlook.office365.com",
          "outlook.office.com"
        ]
      },
      "description": "Verify legitimate Microsoft domain"
    },
    {
      "id": "check_input_fields",
      "type": "dom",
      "weight": 20,
      "condition": {
        "selectors": [
          "input[type='email'][name='loginfmt']",
          "input[type='password'][name='passwd']",
          "input[name='login']",
          "input[name='username']"
        ]
      },
      "description": "Check for Microsoft 365 login form elements"
    },
    {
      "id": "check_referrer",
      "type": "header",
      "weight": 15,
      "condition": {
        "referrer_pattern": "^https://[^/]*\\.microsoft\\.com/"
      },
      "description": "Verify legitimate Microsoft referrer"
    },
    {
      "id": "check_page_elements",
      "type": "content",
      "weight": 25,
      "condition": {
        "hash_elements": [
          "#loginForm",
          ".login-paginated-page",
          "[data-test-id='signin-form']",
          ".ext-sign-in-box"
        ]
      },
      "description": "Check for legitimate Microsoft login page elements"
    },
    {
      "id": "check_microsoft_branding",
      "type": "css",
      "weight": 10,
      "condition": {
        "css_property": "background-image",
        "expected_pattern": "url\\(.*microsoft.*\\)"
      },
      "description": "Verify Microsoft branding elements"
    }
  ],
  
  "thresholds": {
    "legitimate": 90,
    "suspicious": 60,
    "phishing": 30
  },

  "phishing_indicators": [
    {
      "id": "phi_001",
      "pattern": "(?:secure-?(?:microsoft|office|365|outlook))",
      "flags": "i",
      "severity": "high",
      "description": "Suspicious domain mimicking Microsoft services",
      "action": "block",
      "category": "domain_spoofing",
      "confidence": 0.9
    },
    {
      "id": "phi_002",
      "pattern": "(?:microsoft|office|365).*(?:security|verification|account).*(?:team|department|support)",
      "flags": "i",
      "severity": "high",
      "description": "Impersonation of Microsoft security team",
      "action": "block",
      "category": "brand_impersonation",
      "confidence": 0.85
    },
    {
      "id": "phi_003",
      "pattern": "(?:verify.*account|suspended.*365|update.*office|secure.*microsoft)",
      "flags": "i",
      "severity": "medium",
      "description": "Common Microsoft 365 phishing keywords",
      "action": "warn",
      "category": "social_engineering",
      "confidence": 0.7
    },
    {
      "id": "phi_004",
      "pattern": "(?:urgent.*(?:action|update|verify)|immediate.*(?:action|attention)|act.*(?:now|immediately)).*(?:microsoft|office|365)",
      "flags": "i",
      "severity": "medium",
      "description": "Urgency tactics targeting Microsoft users",
      "action": "warn",
      "category": "social_engineering",
      "confidence": 0.65
    },
    {
      "id": "phi_005",
      "pattern": "data:text/html.*(?:microsoft|office|365|outlook).*(?:login|password|signin)",
      "flags": "i",
      "severity": "critical",
      "description": "Data URI containing Microsoft login form",
      "action": "block",
      "category": "credential_harvesting",
      "confidence": 0.95
    }
  ],

  "legitimate_patterns": [
    {
      "id": "leg_001",
      "pattern": "login\\.microsoftonline\\.com",
      "description": "Official Microsoft Online login domain",
      "confidence": 1.0
    },
    {
      "id": "leg_002", 
      "pattern": "portal\\.office\\.com",
      "description": "Official Office 365 portal",
      "confidence": 1.0
    },
    {
      "id": "leg_003",
      "pattern": "outlook\\.office365\\.com",
      "description": "Official Outlook web access",
      "confidence": 1.0
    },
    {
      "id": "leg_004",
      "element_selectors": [
        "input[name='loginfmt']",
        "input[name='passwd']",
        "#loginForm",
        ".login-paginated-page"
      ],
      "description": "Legitimate Microsoft login form elements",
      "confidence": 0.8
    }
  ],

  "suspicious_behaviors": [
    {
      "id": "sus_001",
      "behavior": "password_field_without_microsoft_domain",
      "description": "Password field on non-Microsoft domain with Microsoft branding",
      "severity": "high",
      "action": "warn"
    },
    {
      "id": "sus_002", 
      "behavior": "microsoft_keywords_on_suspicious_domain",
      "description": "Microsoft-related keywords on suspicious domain",
      "severity": "medium",
      "action": "monitor"
    },
    {
      "id": "sus_003",
      "behavior": "form_submit_to_external_domain",
      "description": "Login form submitting to non-Microsoft domain",
      "severity": "critical",
      "action": "block"
    }
  ],

  "whitelist_domains": [
    "*.microsoft.com",
    "*.microsoftonline.com", 
    "*.office.com",
    "*.office365.com",
    "*.live.com",
    "*.msauth.net",
    "*.msftauth.net"
  ],

  "detection_settings": {
    "enable_real_time_scanning": true,
    "enable_form_monitoring": true,
    "enable_url_verification": true,
    "enable_content_analysis": true,
    "enable_verification_badge": true,
    "verification_badge_domains": [
      "login.microsoftonline.com",
      "portal.office.com"
    ],
    "block_threshold": 0.7,
    "warn_threshold": 0.5,
    "monitor_threshold": 0.3
  },

  "configuration": {
    "enable_cryptographic_verification": true,
    "verification_endpoint": "https://365branding.com/api/verify-badge",
    "rules_update_endpoint": "https://api.m365security.com/rules/latest",
    "reporting_endpoint": "https://api.m365security.com/reports/phishing",
    "enable_reporting": true,
    "cache_results": true,
    "cache_ttl": 300000,
    "max_analysis_time": 3000,
    "enable_context_analysis": true,
    "context_window_size": 500
  },

  "rules_metadata": {
    "total_rules": 15,
    "categories": [
      "domain_spoofing",
      "brand_impersonation", 
      "social_engineering",
      "credential_harvesting",
      "suspicious_behavior"
    ],
    "severity_levels": ["low", "medium", "high", "critical"],
    "actions": ["monitor", "warn", "block"],
    "confidence_range": [0.0, 1.0],
    "update_frequency": "daily",
    "source": "Microsoft 365 Security Research Team"
  }
}