# Developer Guide

## Repository Structure
- `config/` – policy schema and branding assets.
- `scripts/` – background and content scripts plus shared modules.
- `rules/` – phishing detection rules.
- `options/` – options page source.
- `popup/` – popup UI code.
- `styles/` – shared stylesheets.
- `images/` – icons and images used throughout the extension.
- `blocked.html` – page shown when a phishing attempt is blocked.
- `manifest.json` – Chrome extension manifest.

## Core Scripts and Modules
- `scripts/background.js` – service worker that loads configuration and policies, runs the detection engine and responds to messages from other parts of the extension.
- `scripts/content.js` – injected into pages to analyse content, display notifications and report events back to the background service worker.
- `popup/popup.js` – popup controller that requests configuration from the background script and exposes tools such as **Scan Page** and **Test Rules**.
- `options/options.js` – options page logic for editing configuration and branding.
- `scripts/modules/config-manager.js` – merges local, enterprise and branding configuration.
- `scripts/modules/detection-engine.js` – parses `rules/detection-rules.json` and performs URL/content analysis.
- `scripts/modules/policy-manager.js` – enforces enterprise policies and compliance rules.

These components communicate using `chrome.runtime.sendMessage`/`onMessage` and Chrome storage. When updating one component ensure message handlers and configuration values remain in sync.

## Build & Packaging
The extension runs directly in the browser without a build step. During development, load the project as an unpacked extension. For distribution, archive the directory (excluding development-only files) and deploy via your preferred mechanism.

## Testing
This repository does not include an automated test suite or npm scripts. Validate changes by loading the extension and exercising features manually.

- `test-extension-loading.html` verifies service worker messaging, content script injection and configuration loading.
- The popup's **Test Rules** button runs the detection engine against sample URLs.
- `test-detection-rules-standalone.html` can be opened without installing the extension to validate rule parsing.

## Security Reporting

If you encounter a potential security issue while developing or reviewing code, please follow the guidelines in [SECURITY.md](../SECURITY.md) and report it privately.

## Suspicious Script Handling

The detection engine now treats dynamic JavaScript execution as suspicious only when it attempts to access sensitive browser
properties. Usage of `eval`, `setTimeout`, or `setInterval` is evaluated for references to `document.cookie` or, when login
fields are present, modifications to `location`. Legitimate timers used for navigation or interface updates are ignored, and
any resulting alerts are reported with **low** severity.

During content analysis, DOM queries are cached per run to avoid redundant lookups, and inline script blocks are decoded from
base64 when possible so that obfuscated dynamic execution is still detected.

## Detection Thresholds

Thresholds have been relaxed to reduce false positives while maintaining protection:

| Category | Value |
|----------|-------|
| `block_threshold` | 0.8 |
| `warn_threshold` | 0.6 |
| `monitor_threshold` | 0.4 |
| `legitimate` score | ≥85 |
| `suspicious` score | ≥55 |
| `phishing` score | <25 |

These values balance sensitivity against the noise generated by legitimate pages and should be reviewed as detection logic
evolves.
